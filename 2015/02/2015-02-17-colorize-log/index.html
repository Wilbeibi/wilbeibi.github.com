<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><title>Colorizing Loggers -- A simple practice of decorator | Wilbeibi Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="author" content="Wilbeibi"><meta name="description" content="colorize text, use dictionary as switch case, decorator with parameters"><meta property="og:type" content="article"><meta property="og:title" content="Colorizing Loggers -- A simple practice of decorator"><meta property="og:url" content="http://wilbeibi.com/2015/02/2015-02-17-colorize-log/index.html"><meta property="og:site_name" content="Wilbeibi Blog"><meta property="og:description" content="colorize text, use dictionary as switch case, decorator with parameters"><meta property="og:updated_time" content="2016-12-08T22:00:04.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Colorizing Loggers -- A simple practice of decorator"><meta name="twitter:description" content="colorize text, use dictionary as switch case, decorator with parameters"><link rel="alternative" href="/atom.xml" title="Wilbeibi Blog" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="apple-touch-icon" href="/img/jacman.jpg"><link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg"><link rel="stylesheet" href="/css/style.css"></head></html><body><header><div><div id="imglogo"><a href="/"><img src="/img/logo.png" alt="Wilbeibi Blog" title="Wilbeibi Blog"></a></div><div id="textlogo"><h1 class="site-name"><a href="/" title="Wilbeibi Blog">Wilbeibi Blog</a></h1><h2 class="blog-motto">The trick, William Potter, is not minding that it hurts</h2></div><div class="navbar"><a class="navbutton navmobile" href="#" title="菜单"></a></div><nav class="animated"><ul><ul><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/wiki/zh_CN/#!index.md" target="_blank">Wiki</a></li><li><a href="/about">About</a></li><li><form class="search" action="//google.com/search" method="get" accept-charset="utf-8"><label>Search</label><input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索"> <input type="hidden" name="q" value="site:wilbeibi.com"></form></li></ul></ul></nav></div></header><div id="container"><div id="main" class="post" itemscope itemprop="blogPost"><article itemprop="articleBody"><header class="article-info clearfix"><h1 itemprop="name"><a href="/2015/02/2015-02-17-colorize-log/" title="Colorizing Loggers -- A simple practice of decorator" itemprop="url">Colorizing Loggers -- A simple practice of decorator</a></h1><p class="article-author">By <a href="/about" title="Wilbeibi" target="_blank" itemprop="author">Wilbeibi</a></p><p class="article-time"><time datetime="2015-02-18T08:00:00.000Z" itemprop="datePublished">发表于 2015-02-18</time></p></header><div class="article-content"><div id="toc" class="toc-article"><strong class="toc-title">文章目录</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-this-post-about"><span class="toc-number">1.</span> <span class="toc-text">What is this post about</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#colorize-your-text"><span class="toc-number">2.</span> <span class="toc-text">colorize your text</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-choose-the-color-in-code"><span class="toc-number">3.</span> <span class="toc-text">How to choose the color in code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Use-the-decorator"><span class="toc-number">4.</span> <span class="toc-text">Use the decorator</span></a></li></ol></div><h2 id="What-is-this-post-about"><a href="#What-is-this-post-about" class="headerlink" title="What is this post about"></a>What is this post about</h2><p>Many people believe that decorator is one of the obscure concepts in Python.<br>Trust me, it is not. To be short, <strong>a decorator is a function that modifies other<br>functions via closures.</strong></p><p>They are plenty detailed articles about what decorator it is so there is no need to write one more. If you are not familiar with it, you may want to check these:</p><ul><li><p><a href="http://sahandsaba.com/python-decorators.html" target="_blank" rel="external">A Study of Python’s More Advanced Features Part II: Closures, Decorators and functools</a></p></li><li><p><a href="https://realpython.com/blog/python/primer-on-python-decorators/#.UvQEs0JdUwJ" target="_blank" rel="external">Primer on Python Decorators</a></p></li></ul><p>In this article, I am going to use a simple but interesting example to show</p><ul><li>how to colorize the output in command line</li><li>how to implement a switch case in Python (Python does not have built-in switch case)</li><li>a decorator with parameters</li></ul><p>OK, let’s rock.</p><h2 id="colorize-your-text"><a href="#colorize-your-text" class="headerlink" title="colorize your text"></a>colorize your text</h2><p>There is a set of escape sequences used to change the color of texts. So if we want to colorize a sentence, we just need to put the sentence between the color escape sequence and reset escape sequence. For example:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt; ORANGE = <span class="string">'\033[33m'</span></div><div class="line">&gt;&gt; RED = <span class="string">'\033[31m'</span></div><div class="line">&gt;&gt; GREEN = <span class="string">'\033[32m'</span></div><div class="line">&gt;&gt; BLUE = <span class="string">'\033[34m'</span></div><div class="line">&gt;&gt; RESET = <span class="string">'\033[0m'</span></div><div class="line">&gt;&gt; <span class="keyword">print</span> ORANGE + <span class="string">"Chinese New Year"</span> + RESET</div><div class="line">&gt;&gt; <span class="keyword">print</span> GREEN + <span class="string">"Chinese"</span> + GREEN + <span class="string">"New"</span> + BLUE + <span class="string">"Year"</span> + RESET</div></pre></td></tr></table></figure><p></p><p>You will see</p><font style="font-family:courier" color="orange">Chinese New Year</font><p>and</p><font style="font-family:courier" color="red">Chinese </font><font style="font-family:courier" color="green">New </font><font style="font-family:courier" color="blue">Year</font><h2 id="How-to-choose-the-color-in-code"><a href="#How-to-choose-the-color-in-code" class="headerlink" title="How to choose the color in code"></a>How to choose the color in code</h2><p>As I said, Python does not support switch case. So we cannot switch the color name and choose the corresponding escaped sequence. Fortunately, dictionary would do the work.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getColor</span><span class="params">(color)</span>:</span></div><div class="line">    <span class="comment"># @param color: string like "red" or "yellow"</span></div><div class="line">    <span class="comment"># @return the corresponding escape sequence.</span></div><div class="line">    <span class="comment"># If not valid, return empty string</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">    RED = <span class="string">'\033[31m'</span>,</div><div class="line">    GREEN = <span class="string">'\033[32m'</span>,</div><div class="line">    BLUE = <span class="string">'\033[34m'</span>,</div><div class="line">    <span class="comment"># and more ...</span></div><div class="line">    ORANGE = <span class="string">'\033[33m'</span></div><div class="line">    &#125;.get(color, <span class="string">""</span>)</div></pre></td></tr></table></figure><p>The trick is, the dictionary’s built in <code>get</code> method. The first parameter here is key, the second optional parameter is default. As the docstring shows:</p><blockquote><p>D.get(k[,d]) -&gt; D[k] if k in D, else d. d defaults to None.</p></blockquote><h2 id="Use-the-decorator"><a href="#Use-the-decorator" class="headerlink" title="Use the decorator"></a>Use the decorator</h2><p>Suppose we have a function to implement a task. It may has three kind of return string, if task is completed successfully, it returns “SUCCESS: blah blah …”, if the task is finished but we cannot ensure it’s corretness, it returns “WARNING: blah blah …”, if task failed, returns “ERROR: blah blah …”, how do we colorize these return strings?</p><p><a href="https://gist.github.com/Wilbeibi/a2ac59f211bcd681d007" target="_blank" rel="external">Raw code</a><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">colorize</span><span class="params">(*args)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getColor</span><span class="params">(color)</span>:</span></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="string">'black'</span> : <span class="string">'\033[30m'</span>,</div><div class="line">            <span class="string">'red'</span> : <span class="string">'\033[31m'</span>,</div><div class="line">            <span class="string">'green'</span> : <span class="string">'\033[32m'</span>,</div><div class="line">            <span class="string">'orange'</span> : <span class="string">'\033[33m'</span>,</div><div class="line">            <span class="string">'blue'</span> : <span class="string">'\033[34m'</span>,</div><div class="line">            <span class="string">'purple'</span> : <span class="string">'\033[35m'</span>,</div><div class="line">            <span class="string">'cyan'</span> : <span class="string">'\033[36m'</span>,</div><div class="line">            <span class="string">'light_grey'</span> : <span class="string">'\033[37m'</span></div><div class="line">        &#125;.get(color, <span class="string">""</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_colorize</span><span class="params">()</span>:</span></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">()</span>:</span></div><div class="line">            RESET = <span class="string">'\033[0m'</span></div><div class="line">            text = func()</div><div class="line">            <span class="comment">#if not isinstance(text, basestring):</span></div><div class="line">            <span class="comment">#    text = str(text)</span></div><div class="line">            level = text.split(<span class="string">':'</span>, <span class="number">1</span>)[<span class="number">0</span>]</div><div class="line">            color = &#123;</div><div class="line">                <span class="string">'SUCCESS'</span>: args[<span class="number">0</span>],</div><div class="line">                <span class="string">'WARNING'</span>: args[<span class="number">1</span>],</div><div class="line">                <span class="string">'ERROR'</span>: args[<span class="number">2</span>]</div><div class="line">            &#125;.get(level, <span class="string">''</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">"&#123;0&#125;&#123;1&#125;&#123;2&#125;"</span>.format(getColor(color), text, RESET)</div><div class="line">        <span class="keyword">return</span> wrapper</div><div class="line">    <span class="keyword">return</span> _colorize</div><div class="line"></div><div class="line"><span class="meta">@colorize("green", "orange", "red")</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_task</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># working working ....</span></div><div class="line">    <span class="keyword">if</span> (success):</div><div class="line">        <span class="keyword">return</span> <span class="string">"SUCCESS: Yeah~~"</span></div><div class="line">    <span class="keyword">elif</span> (warning):</div><div class="line">        <span class="keyword">return</span> <span class="string">"WARNING: wait, what?"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> <span class="string">"ERROR: something went wrong here."</span></div></pre></td></tr></table></figure><p></p><p>As you can tell, to make the decorator with parameters, we need to put it in another decorator.</p><p>Decorator are often used as cache, profiler, logger, synchronization(acquire lock, drop lock) and so forth. One of my favourite library <a href="http://click.pocoo.org/3/" target="_blank" rel="external">Click</a> is also a wonderful example.</p><p>Happy Chinese New Year ~</p></div><footer class="article-footer clearfix"><div class="article-catetags"><div class="article-tags"><span></span> <a href="/tags/python/">python</a></div></div><div class="article-share" id="share"><div data-url="http://wilbeibi.com/2015/02/2015-02-17-colorize-log/" data-title="Colorizing Loggers -- A simple practice of decorator | Wilbeibi Blog" data-tsina="null" class="share clearfix"></div></div></footer></article><nav class="article-nav clearfix"><div class="prev"><a href="/2015/03/2015-03-02-coroutine-producer-comsumer/" title="Producer consumer problem in coroutine"><strong>上一篇：</strong><br><span>Producer consumer problem in coroutine</span></a></div><div class="next"><a href="/2015/02/2015-02-12-2D-pointer/" title="How to delete nodes of linked list with pointers-to-pointers (Chinese)"><strong>下一篇：</strong><br><span>How to delete nodes of linked list with pointers-to-pointers (Chinese)</span></a></div></nav><section id="comments" class="comment"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></div><div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div><div id="toc" class="toc-aside"><strong class="toc-title">文章目录</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-this-post-about"><span class="toc-number">1.</span> <span class="toc-text">What is this post about</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#colorize-your-text"><span class="toc-number">2.</span> <span class="toc-text">colorize your text</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-choose-the-color-in-code"><span class="toc-number">3.</span> <span class="toc-text">How to choose the color in code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Use-the-decorator"><span class="toc-number">4.</span> <span class="toc-text">Use the decorator</span></a></li></ol></div><div id="asidepart"><div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div><aside class="clearfix"><div class="categorieslist"><p class="asidetitle">分类</p><ul><li><a href="/categories/Collection/" title="Collection">Collection<sup>2</sup></a></li></ul></div><div class="tagslist"><p class="asidetitle">标签</p><ul class="clearfix"><li><a href="/tags/notes/" title="notes">notes<sup>8</sup></a></li><li><a href="/tags/writing/" title="writing">writing<sup>4</sup></a></li><li><a href="/tags/Sysadmin/" title="Sysadmin">Sysadmin<sup>3</sup></a></li><li><a href="/tags/git/" title="git">git<sup>2</sup></a></li><li><a href="/tags/miscellaneous/" title="miscellaneous">miscellaneous<sup>2</sup></a></li><li><a href="/tags/algorithms/" title="algorithms">algorithms<sup>2</sup></a></li><li><a href="/tags/python/" title="python">python<sup>2</sup></a></li><li><a href="/tags/RSS/" title="RSS">RSS<sup>1</sup></a></li><li><a href="/tags/subscribe/" title="subscribe">subscribe<sup>1</sup></a></li></ul></div><div class="linkslist"><p class="asidetitle">友情链接</p><ul><li><a href="http://kelunblog.com/" target="_blank" title="可伦的博客">可伦的博客</a></li><li><a href="https://www.jayxon.com/" target="_blank" title="JayXon&#39;s Blog">JayXon&#39;s Blog</a></li><li><a href="http://stackbox.org/" target="_blank" title="叠搭宝箱">叠搭宝箱</a></li><li><a href="http://victoriahong.com/" target="_blank" title="Victoria Hong">Victoria Hong</a></li></ul></div><div class="rsspart"><a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a></div></aside></div></div><footer><div id="footer"><div class="line"><span></span><div class="author"></div></div><section class="info"><p>強烈な努力<br></p></section><div class="social-font" class="clearfix"><a href="https://github.com/wilbeibi" target="_blank" class="icon-github" title="github"></a> <a href="http://stackoverflow.com/users/1035859" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a> <a href="https://www.douban.com/people/wilbeibi" target="_blank" class="icon-douban" title="豆瓣"></a> <a href="mailto:wilbeibi@gmail.com" target="_blank" class="icon-email" title="Email Me"></a></div><div class="cc-license"><a href="http://creativecommons.org/licenses/by-nc/4.0" class="cc-opacity" target="_blank"><img src="/img/cc-by-nc.svg" alt="Creative Commons"></a></div><p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 <a href="/about" target="_blank" title="Wilbeibi">Wilbeibi</a></p></div></footer><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script type="text/javascript">$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth)}$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var n=0,s=$("#main"),a=$("#asidepart"),o=$(".closeaside"),d=$(".openaside");o.click(function(){a.addClass("fadeOut").css("display","none"),d.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),d.click(function(){d.css("display","none").removeClass("beforeFadeIn"),a.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){d.css("top",Math.max(80,260-$(this).scrollTop()))}),$(window).resize(function(){e(),n>=1024?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),a.css("display","block").removeClass("fadeOut"),d.css("display","none"),$("#toc.toc-aside").css("display","none"))})})</script><script type="text/javascript">$(document).ready(function(){var c=$(".article-content>iframe"),n=$(".article-content>embed"),o=($("#toc"),$("#toc.toc-aside")),e=$(".openaside"),i=$(".closeaside");c.length>0&&c.wrap('<div class="video-container" />'),n.length>0&&n.wrap('<div class="video-container" />'),i.click(function(){o.css("display","block").addClass("fadeIn")}),e.click(function(){o.css("display","none")}),$(window).scroll(function(){o.css("top",Math.max(140,320-$(this).scrollTop()))})})</script><script type="text/javascript">$(document).ready(function(){var t=$(".share"),a=t.attr("data-url"),e=encodeURIComponent(a),r=t.attr("data-title"),c=t.attr("data-tsina"),i=(t.attr("description"),['<a href="#" class="overlay" id="qrcode"></a>','<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url='+e+'"/></div>','<a href="https://www.facebook.com/sharer.php?u='+e+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="https://twitter.com/intent/tweet?url='+e+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="#qrcode" class="article-share-qrcode" title="微信"></a>','<a href="http://service.weibo.com/share/share.php?title='+r+"&url="+e+"&ralateUid="+c+'&searchPic=true&style=number" class="article-share-weibo" target="_blank" title="微博"></a>','<span title="Share to"></span>'].join(""));t.append(i),$(".article-share-qrcode").click(function(){var t=$("#qrcode-pic").attr("data-src");$("#qrcode-pic").attr("src",t),$("#qrcode-pic").load(function(){$(".qrcode strong").text(" ")})})})</script><script type="text/javascript">var disqus_shortname="wilmatrix";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}(),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">$(document).ready(function(){$(".article-content").each(function(a){$(this).find("img").each(function(){if(!$(this).parent().hasClass("fancybox")){var a=this.alt;a&&$(this).after('<span class="caption">'+a+"</span>"),$(this).wrap('<a href="'+this.src+'" title="'+a+'" class="fancybox"></a>')}}),$(this).find(".fancybox").each(function(){$(this).attr("rel","article"+a)})}),$.fancybox&&$(".fancybox").fancybox()})</script><script type="text/javascript">!function(e,a,n,t,c,i,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,i=a.createElement(n),o=a.getElementsByTagName(n)[0],i.async=1,i.src=t,o.parentNode.insertBefore(i,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-37214024-1","wilbeibi.com"),ga("send","pageview")</script><div id="totop"><a title="返回顶部"><img src="/img/scrollup.png"></a></div><script src="/js/totop.js"></script><!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>